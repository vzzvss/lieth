<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø®Ø¯Ù…Ø© Ø§Ù„Ø¬ÙˆØ§Ø²Ø§Øª - Ù„ÙŠØ«</title>
    <!-- Ø±Ø¨Ø· Ù…Ù„Ù Manifest -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#1a3a52">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon-192.png">

    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #1a3a52 0%, #2d5a7b 100%);
            --secondary-gradient: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            --whatsapp-color: #25D366;
            --bg-color: #f0f2f5;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a3a52 0%, #0f2636 100%);
            color: #333;
            min-height: 100vh;
            padding: 15px;
            direction: rtl;
            overflow-x: hidden;
        }

        .container { max-width: 500px; margin: 0 auto; padding-bottom: 80px; }

        /* Header */
        .header { text-align: center; margin-bottom: 25px; color: white; }
        .header h1 { font-size: 1.8rem; margin-bottom: 10px; text-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .header-icons { font-size: 2.5rem; animation: float 3s ease-in-out infinite; display: inline-block; }
        
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .wa-btn-top {
            background: white; color: var(--whatsapp-color);
            padding: 8px 20px; border-radius: 50px; text-decoration: none;
            font-weight: bold; display: inline-flex; align-items: center; gap: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); margin-top: 10px;
        }

        /* Form Card */
        .form-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .watermark {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotate(-30deg);
            font-size: 4rem; font-weight: 900;
            color: rgba(26, 58, 82, 0.08); /* Ù„ÙˆÙ† Ù„ÙŠØ« Ø´ÙØ§Ù Ø¬Ø¯Ø§Ù‹ */
            pointer-events: none; white-space: nowrap; z-index: 0;
        }

        .input-group { margin-bottom: 15px; position: relative; z-index: 2; }
        .input-group label {
            display: block; text-align: center; color: #1a3a52;
            font-weight: 700; margin-bottom: 5px; font-size: 0.95rem;
        }
        
        .form-control {
            width: 100%; padding: 12px; border: 2px solid #e1e5e9;
            border-radius: 12px; font-size: 1rem; text-align: center;
            background: rgba(255,255,255,0.8); transition: all 0.3s;
        }
        .form-control:focus {
            border-color: #2d5a7b; outline: none; box-shadow: 0 0 0 4px rgba(45, 90, 123, 0.1);
        }

        /* Stamp */
        .stamp-box {
            border: 3px double #c0392b; color: #c0392b;
            padding: 10px; border-radius: 8px; text-align: center;
            margin-top: 20px; transform: rotate(-5deg);
            display: none; animation: stampPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: rgba(255,255,255,0.9);
            position: absolute; width: 80%; z-index: 10;
        }
        @keyframes stampPop { from { transform: scale(0.5) rotate(0); opacity: 0; } to { transform: scale(1) rotate(-5deg); opacity: 1; } }

        /* Actions */
        .actions { display: grid; gap: 10px; margin-top: 25px; position: relative; z-index: 5; }
        .btn {
            border: none; padding: 14px; border-radius: 12px;
            font-size: 1rem; font-weight: bold; cursor: pointer; color: white;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: transform 0.2s;
        }
        .btn:active { transform: scale(0.98); }
        .btn-confirm { background: var(--primary-gradient); }
        .btn-save { background: #34495e; display: none; }
        .btn-share { background: var(--whatsapp-color); display: none; }

        /* Install App Button */
        .install-prompt {
            position: fixed; bottom: 20px; left: 20px; right: 20px;
            background: #212121; color: white; padding: 15px;
            border-radius: 15px; display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 10px 20px rgba(0,0,0,0.4); z-index: 999;
            transform: translateY(150%); transition: transform 0.4s;
        }
        .install-prompt.show { transform: translateY(0); }
        .install-btn {
            background: var(--whatsapp-color); color: white; border: none;
            padding: 8px 15px; border-radius: 8px; font-weight: bold;
        }

        /* Footer */
        footer { margin-top: 40px; text-align: center; color: rgba(255,255,255,0.7); font-size: 0.85rem; }
        footer a { color: var(--whatsapp-color); text-decoration: none; }

    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1><span class="header-icons">âœˆï¸</span> Ø®Ø¯Ù…Ø© Ø¬ÙˆØ§Ø²Ø§Øª Ù„ÙŠØ« <span class="header-icons">ğŸ›‚</span></h1>
        <a href="https://wa.me/963996250014" class="wa-btn-top">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592z"/></svg>
            ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§
        </a>
    </div>

    <div class="form-card" id="captureArea">
        <div class="watermark">Ø®Ø¯Ù…Ø§Øª Ù„ÙŠØ«</div>
        
        <div class="input-group">
            <label>Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ø§Ù„ÙƒÙÙŠÙ„</label>
            <input type="text" class="form-control" id="id_kafil" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù…">
        </div>
        
        <div class="input-group">
            <label>Ø±Ù‚Ù… Ø§Ù„Ù€ 700</label>
            <input type="number" class="form-control" id="num_700" placeholder="700xxxxxxx">
        </div>

        <div class="input-group">
            <label>Ø±Ù‚Ù… Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©</label>
            <input type="number" class="form-control" id="iqama" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù…">
        </div>

        <div class="input-group">
            <label>Ø±Ù‚Ù… Ø§Ù„Ù†Ø³Ø®Ø©</label>
            <input type="number" class="form-control" id="version" placeholder="1, 2...">
        </div>

        <div class="input-group">
            <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
            <textarea class="form-control" id="notes" rows="2" placeholder="Ø£ÙŠ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
        </div>

        <div id="stamp" class="stamp-box">
            <h3 style="margin:0">ØªÙ… Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ âœ…</h3>
            <div style="font-size:0.8rem; margin:5px 0">
                <span id="date-hj"></span><br>
                <span id="date-gr"></span>
            </div>
            <div style="font-size:0.7rem">ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù†Ø­Ù† ØºÙŠØ± Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† Ø¹Ù† Ø§Ù„Ø®Ø·Ø£</div>
        </div>
    </div>

    <div class="actions">
        <button class="btn btn-confirm" onclick="approve()">âœ… ØªÙ… Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</button>
        <button class="btn btn-save" id="btnSave" onclick="saveImage()">ğŸ“¸ Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©</button>
        <button class="btn btn-share" id="btnShare" onclick="shareWa()">ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§ØªØ³Ø§Ø¨</button>
    </div>

    <footer>
        <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù€: <a href="mailto:Abu_Qais@Android.Apk">Abu_Qais</a></p>
        <div style="margin-top:10px">
            <a href="https://wa.me/963992771933" style="font-size:1.5rem">ğŸ’¬</a>
        </div>
    </footer>
</div>

<!-- ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
<div class="install-prompt" id="installPrompt">
    <div>
        <div style="font-weight:bold">ØªØ·Ø¨ÙŠÙ‚ Ø¬ÙˆØ§Ø²Ø§Øª Ù„ÙŠØ«</div>
        <div style="font-size:0.8rem; opacity:0.8">Ø«Ø¨ØªÙ‡ Ø¹Ù„Ù‰ Ù‡Ø§ØªÙÙƒ Ù„Ù„Ø¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ù†Øª</div>
    </div>
    <button class="install-btn" onclick="installApp()">ØªØ«Ø¨ÙŠØª</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
    // 1. Ù…Ù†Ø·Ù‚ Service Worker ÙˆØ§Ù„Ù€ PWA
    let deferredPrompt;
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./service-worker.js');
        });
    }

    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        document.getElementById('installPrompt').classList.add('show');
    });

    async function installApp() {
        if (deferredPrompt) {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            if (outcome === 'accepted') {
                document.getElementById('installPrompt').classList.remove('show');
            }
            deferredPrompt = null;
        }
    }

    // 2. Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    function approve() {
        const inputs = document.querySelectorAll('input');
        let valid = true;
        inputs.forEach(i => { if(!i.value) valid = false; });
        
        if(!valid) return alert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„!');

        // Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
        const now = new Date();
        const options = { year: 'numeric', month: 'numeric', day: 'numeric' };
        document.getElementById('date-gr').innerText = "Ù…ÙŠÙ„Ø§Ø¯ÙŠ: " + now.toLocaleDateString('ar-SA', options);
        document.getElementById('date-hj').innerText = "Ù‡Ø¬Ø±ÙŠ: " + now.toLocaleDateString('ar-SA-u-ca-islamic', options);

        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø®ØªÙ… ÙˆÙ…ÙƒØ§Ù† Ø¹Ø´ÙˆØ§Ø¦ÙŠ
        const stamp = document.getElementById('stamp');
        stamp.style.display = 'block';
        stamp.style.top = (Math.random() * 40 + 20) + '%'; 
        stamp.style.right = (Math.random() * 20 + 10) + '%';

        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        document.getElementById('btnSave').style.display = 'flex';
        document.getElementById('btnShare').style.display = 'flex';
        document.querySelector('.btn-confirm').style.display = 'none';
        
        // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„
        inputs.forEach(i => i.disabled = true);
        document.querySelector('textarea').disabled = true;
    }

    async function saveImage() {
        const element = document.getElementById('captureArea');
        const canvas = await html2canvas(element, { scale: 2, backgroundColor: '#ffffff' });
        const link = document.createElement('a');
        link.download = `Laith-Passport-${Date.now()}.png`;
        link.href = canvas.toDataURL();
        link.click();
    }

    async function shareWa() {
        const element = document.getElementById('captureArea');
        try {
            const canvas = await html2canvas(element, { scale: 2 });
            canvas.toBlob(async (blob) => {
                const file = new File([blob], "passport.png", { type: "image/png" });
                
                // Ø¥Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ¯Ø¹Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
                if (navigator.canShare && navigator.canShare({ files: [file] })) {
                    await navigator.share({
                        files: [file],
                        title: 'Ø®Ø¯Ù…Ø© Ø¬ÙˆØ§Ø²Ø§Øª Ù„ÙŠØ«',
                        text: 'ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ…'
                    });
                } else {
                    //Fallback: Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Øµ ÙÙ‚Ø·
                    const note = document.getElementById('notes').value;
                    const url = `https://wa.me/963996250014?text=${encodeURIComponent('ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯: ' + note)}`;
                    window.open(url, '_blank');
                }
            });
        } catch (err) {
            console.error(err);
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©ØŒ Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ù†ØµÙŠØ©');
            window.open('https://wa.me/963996250014', '_blank');
        }
    }
</script>

</body>
</html>
